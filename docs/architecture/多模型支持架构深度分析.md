# 多模型支持架构深度分析

### 模型提供商抽象层

#### 统一模型客户端接口
```python
from abc import ABC, abstractmethod
from typing import Dict, Any, List, Optional
import asyncio

class BaseModelClient(ABC):
    """统一的模型客户端接口，支持多种AI提供商"""

    def __init__(self, config: Dict[str, Any]):
        self.config = config
        self.provider_name = self.get_provider_name()

    @abstractmethod
    def get_provider_name(self) -> str:
        """返回提供商名称"""
        pass

    @abstractmethod
    async def generate_response(
        self,
        messages: List[Dict[str, Any]],
        **kwargs
    ) -> str:
        """生成AI响应"""
        pass

    @abstractmethod
    def get_default_config(self) -> Dict[str, Any]:
        """获取默认配置"""
        pass

    @abstractmethod
    def validate_config(self, config: Dict[str, Any]) -> bool:
        """验证配置有效性"""
        pass

class ModelClientFactory:
    """模型客户端工厂"""

    _clients = {
        "openai": lambda config: OpenAIModelClient(config),
        "zhipuai": lambda config: ZhipuAIModelClient(config),
        "azure_openai": lambda config: AzureOpenAIModelClient(config),
    }

    @classmethod
    def create_client(cls, provider: str, config: Dict[str, Any]) -> BaseModelClient:
        """创建指定提供商的客户端"""
        if provider not in cls._clients:
            raise ValueError(f"Unsupported provider: {provider}")

        client = cls._clients[provider](config)
        if not client.validate_config(config):
            raise ValueError(f"Invalid config for provider: {provider}")

        return client

    @classmethod
    def register_client(cls, provider: str, client_factory):
        """注册新的客户端类型"""
        cls._clients[provider] = client_factory
```
